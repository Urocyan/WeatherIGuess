<head>	
	<title>Open Weather</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>
$(document).ready(function () {
	var gotCoords = false;
	var latitude = null;
	var longitude = null;
	var parseDate = function(dt_txt) {
		var today = dt_txt;
		var todayDate = today.split(" ");
		today = todayDate[0];
		return today;
	}
	var formatDate = function(dt_txt) {
		var date = dt_txt.split(" ")[0];
		date = date.split("-");
		var formattedDate = date[2] + ", " + date[1] + " " + date[0];
		return formattedDate;
	}
	var getLoc = function() {
		if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
		gotCoords = true;
		} else { 
        gotCoords = false;
		}
	}
	var showPosition = function(position) {
		latitude = position.coords.latitude;
		latitude = latitude.toPrecision(5);
		longitude = position.coords.longitude;
		longitude = longitude.toPrecision(5);
	}
	
	var getWeather = function() {
		if($("#zipInput").val() == "") {
			if((latitude != null && longitude != null)) {
			var openWeather = "http://api.openweathermap.org/data/2.5/weather?&APPID=4f1467625e222a3345ce0a44f13333e7&lat="+latitude+"&lon="+longitude;
			console.log(openWeather);
			}
		}
		else {
			var curZip = $("#zipInput").val();
			if(curZip.length != 5 || isNaN(curZip)) {
			$("#alertBox").removeClass("alert-success");
			$("#alertBox").addClass("alert-warning");
			}
			else {
			$("#alertBox").addClass("alert-success");
			$("#alertBox").removeClass("alert-warning");
			var openWeather = "http://api.openweathermap.org/data/2.5/weather?&APPID=4f1467625e222a3345ce0a44f13333e7&zip="+curZip;
			}
		}
		$.ajax({
			type: "GET",
			dataType: "json",
			url: openWeather,
			success: function( data ) {
			var curTemp = (data.main.temp * (9/5)) - 459.67;
			curTemp = curTemp.toPrecision(4);
			var curHum = data.main.humidity + "%";
			var location = data.name;
			var weatherDesc = data.weather[0].description;
			$("#loc").text( location );
			$("#weatherDesc").text( weatherDesc );
			$("#temp").text( curTemp + " F");
			$("#hum").text( curHum );
			if(curTemp < 60) {
				$("#mainPage").css("background-color", "turquoise");
			}
			else if(curTemp >= 60 && curTemp <= 90) {
				$("#mainPage").css("background-color", "orange");
			}
			else if(curTemp > 90) {
				$("#mainPage").css("background-color", "red");
			}
			$("#weatherHolder").css("opacity","1");
			$("#loadForecastButton").css("opacity","1");
		}
	});
	} 
	$("#geolocButton").click(function() {
		getLoc();
		setTimeout(function() {
			console.log("Checked");
			if(latitude != null && longitude != null) {
				$("#geolocButton").removeClass("btn-info");
				$("#geolocButton").addClass("btn-success");
				$("#geoIcon").attr("class","glyphicon glyphicon-ok");
			}
		}, 4000);
	});
	$("#getWeatherButton").click( function() {
		getWeather();
	});
	var fiveDayForecast = function() {
		var openWeatherForecast = "http://api.openweathermap.org/data/2.5/forecast?&units=imperial&APPID=4f1467625e222a3345ce0a44f13333e7&lat="+latitude+"&lon="+longitude;
		console.log(openWeatherForecast);
		var today = "";
		var notToday = "";
		var todayDate = [];
		$.ajax({
			type: "GET",
			dataType: "json",
			url: openWeatherForecast,
			success: function( data ) {
			$.each( data.list, function( i, item ) {
				if(i == 4) {
					today = parseDate(item.dt_txt);
					$("<div>").attr("class","col-lg-6")
					.html("<div class='panel panel-default'><div class='panel-heading'>"+formatDate(item.dt_txt)+" - "+item.weather[0].description+"</div><div class='panel-body'><h3>Temperature: "+item.main.temp+"</h3><br /><h3>Humidity: "+item.main.humidity+"%</h3></div></div>")
					.appendTo("#forecastHolder");
				}
				if(item.dt_txt.indexOf(today) == -1) {
					today = parseDate(item.dt_txt);
					$("<div>").attr("class","col-lg-6")
					.html("<div class='panel panel-default'><div class='panel-heading'>"+formatDate(item.dt_txt)+" - "+item.weather[0].description+"</div><div class='panel-body'><h3>Temperature: "+item.main.temp+"</h3><br /><h3>Humidity: "+item.main.humidity+"%</h3></div></div>")
					.appendTo("#forecastHolder");
				}
			});
		}
	});
	}
	$("#loadForecastButton").click( function() {
		
		fiveDayForecast();
	});
});
</script>
<style>
h3 {
	text-color: black;
	font-family: Helvetica;
	transition: color 2s ease;
}
body {
	transition: background-color 2s ease;
}
#weatherHolder {
	opacity: 0;
	transition: opacity 2s ease;
}
#loadForecastButton {
	opacity: 0;
	transition: opacity 2s ease;
</style>
</head>
<body id="mainPage" ng-app="">
<div class="row">
	<div class="col-lg-12">
		<div class="input-group">
			<span class="input-group-addon">Zip Code</span>
			<input id="zipInput" type="text" class="form-control" name="msg" placeholder="Enter Zip Code Here" ng-model="name" style="display: block;">
		</div>
	</div>
</div>
<div class="row">
	<div class="col-lg-12">
		<div class="input-group">
			<div class="input-group-btn">
				<button class="btn btn-info" style="width:100%;" id="geolocButton">Detect Location <span id="geoIcon" class="glyphicon glyphicon-screenshot"></span></button>
			</div>
			<div class="input-group-btn">
				<button class="btn btn-primary" style="width:100%;" id="getWeatherButton">Get Weather <span class="glyphicon glyphicon-refresh"></span></button>
			</div>
		</div>
	</div>
	<div class="col-lg-12">
	<p id="alertBox" ng-bind="name" class="alert alert-success"></p>
	</div>
</div>
<div class="row">
	<div class="col-lg-12">
	<div class="panel panel-default" id="weatherHolder">
		<div class="panel-heading"><h3><span id="loc"></span>: <span id="weatherDesc"></span></h3></div>
	<div class="panel-body">
	<h3>Current Temperature: <span id="temp"></span></h3>
	<br />
	<h3>Humidity: <span id="hum"></span></h3>
	</div>
	</div>
	</div>
</div>
<div class="container-fluid">
	<button class="btn btn-primary" style="width: 100%;" id="loadForecastButton">5 Day Forecast <span class="glyphicon glyphicon-triangle-bottom"></span>
</button>
<div class="row" id="forecastHolder">
</div>
</div>
</body>
</html>